{"version":3,"file":"questionLoader-DjJgUGhF.js","sources":["../../src/lib/questionLoader.ts"],"sourcesContent":["/**\n * Question Loader - Loads and caches questions from JSON files\n */\n\nimport type { Question, DifficultyLevel } from '@/types/question';\n\n/**\n * Raw question format from JSON files\n */\ninterface RawQuestion {\n  id: string;\n  exam: string;\n  unit: number;\n  unitTitle: string;\n  chapter: string;\n  chapterTitle: string;\n  question: string;\n  options: {\n    A: string;\n    B: string;\n    C: string;\n    D: string;\n  };\n  correctAnswer: string;\n  explanation?: string;\n  difficulty: DifficultyLevel;\n  tags?: string[];\n}\n\n/**\n * Exam slug type\n */\ntype ExamSlug = 'door-supervisor' | 'security-guard' | 'cctv-operator' | 'close-protection';\n\n/**\n * Map exam slug to exam code\n */\nconst EXAM_SLUG_TO_CODE: Record<ExamSlug, string> = {\n  'door-supervisor': 'ds',\n  'security-guard': 'sg',\n  'cctv-operator': 'cctv',\n  'close-protection': 'cp',\n};\n\n/**\n * In-memory cache for loaded questions\n */\nconst questionCache = new Map<ExamSlug, Question[]>();\n\n/**\n * Convert raw question to Question type\n * Note: We preserve unitTitle and chapterTitle as additional properties\n * even though they're not in the Question type definition\n */\nfunction convertRawQuestion(raw: RawQuestion): Question {\n  return {\n    id: raw.id,\n    qualification: raw.exam.toUpperCase() as any,\n    unitId: `U${raw.unit}`,\n    chapterId: raw.chapter,\n    questionText: raw.question,\n    type: 'multiple-choice',\n    options: [\n      { id: 'A', text: raw.options.A, isCorrect: raw.correctAnswer === 'A' },\n      { id: 'B', text: raw.options.B, isCorrect: raw.correctAnswer === 'B' },\n      { id: 'C', text: raw.options.C, isCorrect: raw.correctAnswer === 'C' },\n      { id: 'D', text: raw.options.D, isCorrect: raw.correctAnswer === 'D' },\n    ],\n    explanation: raw.explanation,\n    difficulty: raw.difficulty,\n    tags: raw.tags || [],\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n    // Preserve additional metadata for UI purposes\n    unitTitle: raw.unitTitle,\n    chapterTitle: raw.chapterTitle,\n  } as Question;\n}\n\n/**\n * Load questions for a specific exam from JSON file\n * @param examSlug - The exam slug (e.g., 'door-supervisor')\n * @returns Promise resolving to array of questions\n * @throws Error if file cannot be loaded\n */\nexport async function loadExamQuestions(examSlug: ExamSlug): Promise<Question[]> {\n  // Check cache first\n  if (questionCache.has(examSlug)) {\n    const cached = questionCache.get(examSlug)!;\n    console.log(`[questionLoader] Loaded ${cached.length} questions from cache for ${examSlug}`);\n    return cached;\n  }\n\n  try {\n    const fetchUrl = `${import.meta.env.BASE_URL}data/questions/${examSlug}.json`;\n    console.log(`[questionLoader] Fetching questions from: ${fetchUrl}`);\n\n    // Import the JSON file dynamically\n    const response = await fetch(fetchUrl);\n\n    if (!response.ok) {\n      console.error(`[questionLoader] Fetch failed with status ${response.status}: ${response.statusText}`);\n      throw new Error(`Failed to load questions for ${examSlug}: ${response.statusText}`);\n    }\n\n    const rawQuestions: RawQuestion[] = await response.json();\n    console.log(`[questionLoader] Fetched ${rawQuestions.length} raw questions for ${examSlug}`);\n\n    // Convert to Question type\n    const questions = rawQuestions.map(convertRawQuestion);\n    console.log(`[questionLoader] Converted ${questions.length} questions successfully`);\n\n    // Cache the results\n    questionCache.set(examSlug, questions);\n\n    return questions;\n  } catch (error) {\n    console.error(`[questionLoader] Error loading questions for ${examSlug}:`, error);\n    throw new Error(`Failed to load questions for ${examSlug}. Please try again later.`);\n  }\n}\n\n/**\n * Load questions for a specific chapter\n * @param examSlug - The exam slug\n * @param unit - The unit number\n * @param chapter - The chapter identifier (e.g., \"1.1\")\n * @returns Array of questions for the chapter\n */\nexport async function loadChapterQuestions(\n  examSlug: ExamSlug,\n  unit: number,\n  chapter: string\n): Promise<Question[]> {\n  const allQuestions = await loadExamQuestions(examSlug);\n\n  return allQuestions.filter(\n    (q) => q.unitId === `U${unit}` && q.chapterId === chapter\n  );\n}\n\n/**\n * Get a specific question by ID\n * @param questionId - The question ID\n * @returns The question or undefined if not found\n */\nexport async function getQuestionById(questionId: string): Promise<Question | undefined> {\n  // Extract exam code from question ID (e.g., \"DS-U1-C1_1-001\" -> \"DS\")\n  const examCode = questionId.split('-')[0]?.toLowerCase();\n\n  // Find the matching exam slug\n  const examSlug = Object.entries(EXAM_SLUG_TO_CODE).find(\n    ([_, code]) => code === examCode\n  )?.[0] as ExamSlug | undefined;\n\n  if (!examSlug) {\n    console.error(`Invalid question ID format: ${questionId}`);\n    return undefined;\n  }\n\n  try {\n    const questions = await loadExamQuestions(examSlug);\n    return questions.find((q) => q.id === questionId);\n  } catch (error) {\n    console.error(`Error getting question ${questionId}:`, error);\n    return undefined;\n  }\n}\n\n/**\n * Filter questions by criteria\n * @param examSlug - The exam slug\n * @param filters - Filter criteria\n * @returns Filtered array of questions\n */\nexport async function filterQuestions(\n  examSlug: ExamSlug,\n  filters: {\n    units?: number[];\n    chapters?: string[];\n    difficulty?: DifficultyLevel[];\n    tags?: string[];\n  }\n): Promise<Question[]> {\n  const allQuestions = await loadExamQuestions(examSlug);\n\n  return allQuestions.filter((question) => {\n    // Filter by units\n    if (filters.units && filters.units.length > 0) {\n      const unitNumber = parseInt(question.unitId.substring(1));\n      if (!filters.units.includes(unitNumber)) {\n        return false;\n      }\n    }\n\n    // Filter by chapters\n    if (filters.chapters && filters.chapters.length > 0) {\n      if (!filters.chapters.includes(question.chapterId)) {\n        return false;\n      }\n    }\n\n    // Filter by difficulty\n    if (filters.difficulty && filters.difficulty.length > 0) {\n      if (!filters.difficulty.includes(question.difficulty)) {\n        return false;\n      }\n    }\n\n    // Filter by tags\n    if (filters.tags && filters.tags.length > 0) {\n      const questionTags = question.tags || [];\n      if (!filters.tags.some((tag) => questionTags.includes(tag))) {\n        return false;\n      }\n    }\n\n    return true;\n  });\n}\n\n/**\n * Clear the question cache\n * Useful for testing or when questions are updated\n */\nexport function clearQuestionCache(): void {\n  questionCache.clear();\n}\n\n/**\n * Get all available exam slugs\n */\nexport function getAvailableExams(): ExamSlug[] {\n  return Object.keys(EXAM_SLUG_TO_CODE) as ExamSlug[];\n}\n\n/**\n * Get exam code from slug\n */\nexport function getExamCode(examSlug: ExamSlug): string {\n  return EXAM_SLUG_TO_CODE[examSlug];\n}\n"],"names":["questionCache","convertRawQuestion","raw","loadExamQuestions","examSlug","cached","fetchUrl","response","rawQuestions","questions","error"],"mappings":"AA+CA,MAAMA,MAAoB,IAO1B,SAASC,EAAmBC,EAA4B,CACtD,MAAO,CACL,GAAIA,EAAI,GACR,cAAeA,EAAI,KAAK,YAAA,EACxB,OAAQ,IAAIA,EAAI,IAAI,GACpB,UAAWA,EAAI,QACf,aAAcA,EAAI,SAClB,KAAM,kBACN,QAAS,CACP,CAAE,GAAI,IAAK,KAAMA,EAAI,QAAQ,EAAG,UAAWA,EAAI,gBAAkB,GAAA,EACjE,CAAE,GAAI,IAAK,KAAMA,EAAI,QAAQ,EAAG,UAAWA,EAAI,gBAAkB,GAAA,EACjE,CAAE,GAAI,IAAK,KAAMA,EAAI,QAAQ,EAAG,UAAWA,EAAI,gBAAkB,GAAA,EACjE,CAAE,GAAI,IAAK,KAAMA,EAAI,QAAQ,EAAG,UAAWA,EAAI,gBAAkB,GAAA,CAAI,EAEvE,YAAaA,EAAI,YACjB,WAAYA,EAAI,WAChB,KAAMA,EAAI,MAAQ,CAAA,EAClB,UAAW,IAAI,KAAA,EAAO,YAAA,EACtB,UAAW,IAAI,KAAA,EAAO,YAAA,EAEtB,UAAWA,EAAI,UACf,aAAcA,EAAI,YAAA,CAEtB,CAQA,eAAsBC,EAAkBC,EAAyC,CAE/E,GAAIJ,EAAc,IAAII,CAAQ,EAAG,CAC/B,MAAMC,EAASL,EAAc,IAAII,CAAQ,EACzC,eAAQ,IAAI,2BAA2BC,EAAO,MAAM,6BAA6BD,CAAQ,EAAE,EACpFC,CACT,CAEA,GAAI,CACF,MAAMC,EAAW,4BAA6CF,CAAQ,QACtE,QAAQ,IAAI,6CAA6CE,CAAQ,EAAE,EAGnE,MAAMC,EAAW,MAAM,MAAMD,CAAQ,EAErC,GAAI,CAACC,EAAS,GACZ,cAAQ,MAAM,6CAA6CA,EAAS,MAAM,KAAKA,EAAS,UAAU,EAAE,EAC9F,IAAI,MAAM,gCAAgCH,CAAQ,KAAKG,EAAS,UAAU,EAAE,EAGpF,MAAMC,EAA8B,MAAMD,EAAS,KAAA,EACnD,QAAQ,IAAI,4BAA4BC,EAAa,MAAM,sBAAsBJ,CAAQ,EAAE,EAG3F,MAAMK,EAAYD,EAAa,IAAIP,CAAkB,EACrD,eAAQ,IAAI,8BAA8BQ,EAAU,MAAM,yBAAyB,EAGnFT,EAAc,IAAII,EAAUK,CAAS,EAE9BA,CACT,OAASC,EAAO,CACd,cAAQ,MAAM,gDAAgDN,CAAQ,IAAKM,CAAK,EAC1E,IAAI,MAAM,gCAAgCN,CAAQ,2BAA2B,CACrF,CACF"}