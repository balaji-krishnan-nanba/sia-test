import{l as A}from"./questionLoader-DjJgUGhF.js";import{j as e,C as I,s as y}from"./index-DKDRh3Ci.js";import{R as N,c as T}from"./react-vendor-CYaOf62E.js";import{D as z}from"./Badge-DEFM6kQD.js";import{M as B}from"./Modal-B4PKGg3O.js";function O(t){let s=Math.abs(Math.floor(t))||1;return()=>(s=(s*1664525+1013904223)%4294967296,s/4294967296)}function $(t,s){const r=[...t],n=O(s);for(let o=r.length-1;o>0;o--){const i=Math.floor(n()*(o+1)),c=r[o];r[o]=r[i],r[i]=c}return r}function Y(t,s){let r=0;const n=`${t}-test-${s}`;for(let o=0;o<n.length;o++){const i=n.charCodeAt(o);r=(r<<5)-r+i,r=r&r}return Math.abs(r)}const _={easy:.4,medium:.4,hard:.2};function k(t){const s=[...t];for(let r=s.length-1;r>0;r--){const n=Math.floor(Math.random()*(r+1)),o=s[r];s[r]=s[n],s[n]=o}return s}function H(t){return k(t)}function R(t){return{...t,options:k(t.options)}}async function J(t,s,r={}){const{shuffleAnswers:n=!0,ensureBalancedUnits:o=!0,seed:i,filterUnits:c}=r,h=d=>i!==void 0?$(d,i):k(d);let f=await A(t);if(c&&c.length>0&&(f=f.filter(d=>{const x=parseInt(d.unitId.substring(1));return c.includes(x)})),f.length===0)throw new Error(`No questions found for exam: ${t}`);const a={easy:Math.round(s*_.easy),medium:Math.round(s*_.medium),hard:Math.round(s*_.hard)},l=s-(a.easy+a.medium+a.hard);l!==0&&(a.medium+=l);const u={easy:f.filter(d=>d.difficulty==="easy"),medium:f.filter(d=>d.difficulty==="medium"),hard:f.filter(d=>d.difficulty==="hard")};Object.entries(u).forEach(([d,x])=>{const b=a[d];x.length<b&&console.warn(`Not enough ${d} questions. Required: ${b}, Available: ${x.length}`)});const m=[];if(o)for(const[d,x]of Object.entries(a)){const b=u[d],g=new Map;b.forEach(p=>{g.has(p.unitId)||g.set(p.unitId,[]),g.get(p.unitId).push(p)}),g.forEach(p=>{var w;const j=(w=p[0])==null?void 0:w.unitId;j&&g.set(j,h(p))});const M=Array.from(g.keys()).sort();let C=0,E=0;for(;E<x&&m.length<s;){const p=M[C%M.length],j=g.get(p);if(j.length>0){const w=j.shift();m.push(w),E++}if(C++,Array.from(g.values()).every(w=>w.length===0))break}}else for(const[d,x]of Object.entries(a)){const b=h(u[d]),g=Math.min(x,b.length);m.push(...b.slice(0,g))}let v=h(m);return n&&(i!==void 0?v=v.map((d,x)=>({...d,options:$(d.options,i+1e3+x)})):v=v.map(R)),v}const Q=N.memo(({options:t,selectedAnswer:s,correctAnswer:r,showResult:n=!1,onSelect:o,disabled:i=!1})=>{const c=["A","B","C","D"];T.useEffect(()=>{const a=l=>{if(i)return;const u=l.key;if(["1","2","3","4"].includes(u)){const m=parseInt(u)-1,v=c[m];v&&o(v)}else c.includes(u.toUpperCase())&&o(u.toUpperCase())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[i,o]);const h=a=>{const l="w-full text-left px-4 py-4 rounded-lg border-2 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 min-h-[48px] flex items-start gap-3";return i&&!n?`${l} border-gray-300 bg-gray-50 cursor-not-allowed opacity-50`:n&&r?a===r?`${l} border-accent-500 bg-accent-50 text-accent-900 font-medium`:a===s&&a!==r?`${l} border-error-500 bg-error-50 text-error-900`:`${l} border-gray-300 bg-gray-50 text-gray-600`:s===a?`${l} border-primary-500 bg-primary-50 text-primary-900 font-medium hover:bg-primary-100 focus:ring-primary-500`:`${l} border-gray-300 bg-white hover:border-primary-300 hover:bg-primary-50 focus:ring-primary-500 active:bg-primary-100`},f=a=>!n||!r?null:a===r?e.jsx("svg",{className:"h-5 w-5 text-accent-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):a===s&&a!==r?e.jsx("svg",{className:"h-5 w-5 text-error-600 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}):null;return e.jsx("div",{className:"space-y-3",role:"radiogroup","aria-label":"Answer options",children:c.map((a,l)=>e.jsxs("button",{onClick:()=>!i&&o(a),disabled:i&&!n,className:h(a),role:"radio","aria-checked":s===a,"aria-label":`Option ${a}: ${t[a]}`,children:[e.jsxs("span",{className:"flex-shrink-0 font-semibold text-gray-700",children:[a,"."]}),e.jsx("span",{className:"flex-1",children:t[a]}),f(a),e.jsxs("span",{className:"sr-only",children:["(Press ",l+1,")"]})]},a))})});Q.displayName="AnswerOptions";const S=N.memo(({explanation:t,isCorrect:s,correctAnswer:r,show:n})=>n?e.jsxs("div",{className:`mt-6 rounded-lg border-l-4 p-4 animate-slide-up ${s?"border-accent-500 bg-accent-50":"border-error-500 bg-error-50"}`,role:"region","aria-label":"Answer explanation","aria-live":"polite",children:[e.jsx("div",{className:"mb-3 flex items-center gap-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-6 w-6 text-accent-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("h3",{className:"text-lg font-semibold text-accent-900",children:"Correct!"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-6 w-6 text-error-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-error-900",children:"Incorrect"}),e.jsxs("p",{className:"text-sm text-error-700",children:["The correct answer is ",e.jsx("strong",{children:r})]})]})]})}),e.jsxs("div",{className:`text-sm leading-relaxed ${s?"text-accent-800":"text-error-800"}`,children:[e.jsx("p",{className:"font-medium mb-1",children:"Explanation:"}),e.jsx("p",{children:t})]})]}):null);S.displayName="ExplanationPanel";const U=N.memo(({questionNumber:t,totalQuestions:s,question:r,selectedAnswer:n,onAnswerSelect:o,showResult:i=!1,isCorrect:c=!1,isBookmarked:h=!1,onBookmarkToggle:f,disabled:a=!1})=>e.jsxs(I,{padding:"lg",className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Question ",t," of ",s]}),e.jsx(z,{difficulty:r.difficulty,size:"sm"})]}),f&&e.jsx("button",{onClick:f,className:"p-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-colors","aria-label":h?"Remove bookmark":"Add bookmark",children:h?e.jsx("svg",{className:"h-6 w-6 text-warning-500 fill-current",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"})}):e.jsx("svg",{className:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})})]}),(r.unitTitle||r.chapterTitle)&&e.jsxs("div",{className:"mb-4 text-sm text-gray-600",children:[r.unitTitle&&e.jsx("span",{children:r.unitTitle}),r.unitTitle&&r.chapterTitle&&e.jsx("span",{className:"mx-2",children:"â€¢"}),r.chapterTitle&&e.jsx("span",{children:r.chapterTitle})]}),e.jsx("div",{className:"mb-6",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900 leading-relaxed",children:r.question})}),e.jsx(Q,{options:r.options,selectedAnswer:n,correctAnswer:i?r.correctAnswer:void 0,showResult:i,onSelect:o,disabled:a}),e.jsx(S,{explanation:r.explanation,isCorrect:c,correctAnswer:r.correctAnswer,show:i}),!i&&e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["Use keyboard shortcuts: Press ",e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"1-4"})," or ",e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"A-D"})," to select an answer"]})})]}));U.displayName="QuestionCard";const F=N.memo(({questions:t,currentIndex:s,onNavigate:r,mode:n="modal",isOpen:o=!0,onClose:i})=>{const c=t.filter(l=>l.answered).length,h=t.filter(l=>l.flagged).length,f=(l,u)=>{const m="w-12 h-12 rounded-lg font-semibold transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 relative";return l===s?`${m} bg-primary-600 text-white ring-2 ring-primary-500`:u.answered?u.correct!==void 0?u.correct?`${m} bg-accent-100 text-accent-700 border-2 border-accent-500 hover:bg-accent-200`:`${m} bg-error-100 text-error-700 border-2 border-error-500 hover:bg-error-200`:`${m} bg-secondary-100 text-secondary-700 border-2 border-secondary-400 hover:bg-secondary-200`:`${m} bg-white text-gray-700 border-2 border-gray-300 hover:bg-gray-50 hover:border-gray-400`},a=()=>e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"mb-6 space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Question Navigator"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-secondary-400"}),e.jsxs("span",{children:[c," answered"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-gray-300"}),e.jsxs("span",{children:[t.length-c," unanswered"]})]}),h>0&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("svg",{className:"h-3 w-3 text-warning-500 fill-current",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"})}),e.jsxs("span",{children:[h," flagged"]})]})]})]}),e.jsx("div",{className:"grid grid-cols-5 gap-3 overflow-y-auto flex-1",children:t.map((l,u)=>e.jsxs("button",{onClick:()=>{r(u),n==="modal"&&i&&i()},className:f(u,l),"aria-label":`Question ${u+1}${l.answered?" (answered)":""}${l.flagged?" (flagged)":""}`,"aria-current":u===s?"true":void 0,children:[e.jsx("span",{children:u+1}),l.flagged&&e.jsx("svg",{className:"absolute -top-1 -right-1 h-4 w-4 text-warning-500 fill-current",viewBox:"0 0 20 20","aria-hidden":"true",children:e.jsx("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"})})]},u))}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"Legend:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary-600"}),e.jsx("span",{children:"Current"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-secondary-100 border-2 border-secondary-400"}),e.jsx("span",{children:"Answered"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white border-2 border-gray-300"}),e.jsx("span",{children:"Unanswered"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-accent-100 border-2 border-accent-500"}),e.jsx("span",{children:"Correct"})]})]})]})]});return n==="modal"?e.jsx(B,{isOpen:o,onClose:i||(()=>{}),title:"Navigate Questions",size:"md",children:e.jsx(a,{})}):e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 shadow-card p-6 h-full",children:e.jsx(a,{})})});F.displayName="QuestionNavigator";const L=new Map;async function Z(t,s){try{const{error:r}=await y.from("question_attempts").insert({user_id:t,question_id:s.questionId,unit_id:s.unitId,chapter_id:s.chapterId,difficulty:s.difficulty,user_answer:s.userAnswer,correct_answer:s.correctAnswer,is_correct:s.isCorrect,time_spent:s.timeSpent,attempted_at:s.attemptedAt});if(r)throw console.error("Error saving question attempt:",r),new Error("Failed to save question attempt");L.delete(t),await P(t,s)}catch(r){throw console.error("Error in saveQuestionAttempt:",r),r}}async function P(t,s){const r=new Date().toISOString().split("T")[0];try{const{data:n,error:o}=await y.from("daily_activities").select("*").eq("user_id",t).eq("date",r).single();if(o&&o.code!=="PGRST116")throw o;const i=Math.ceil(s.timeSpent/60);if(n){const{error:c}=await y.from("daily_activities").update({questions_answered:n.questions_answered+1,correct_answers:n.correct_answers+(s.isCorrect?1:0),study_time:n.study_time+i,updated_at:new Date().toISOString()}).eq("id",n.id);if(c)throw c}else{const{error:c}=await y.from("daily_activities").insert({user_id:t,date:r,questions_answered:1,correct_answers:s.isCorrect?1:0,study_time:i,mock_exams_taken:0});if(c)throw c}}catch(n){console.error("Error updating daily activity:",n)}}async function q(t,s){try{const{data:r,error:n}=await y.from("mock_exam_attempts").insert({user_id:t,qualification:s.qualification,score:s.score,passing_score:s.passingScore,passed:s.score>=s.passingScore,total_questions:s.totalQuestions,correct_answers:s.correctAnswers,time_spent:s.timeSpent,questions:s.questions,completed_at:new Date().toISOString()}).select("id").single();if(n)throw n;const o=new Date().toISOString().split("T")[0],{data:i}=await y.from("daily_activities").select("*").eq("user_id",t).eq("date",o).single();return i?await y.from("daily_activities").update({mock_exams_taken:i.mock_exams_taken+1}).eq("id",i.id):await y.from("daily_activities").insert({user_id:t,date:o,questions_answered:0,correct_answers:0,study_time:0,mock_exams_taken:1}),L.delete(t),r.id}catch(r){throw console.error("Error saving mock exam result:",r),new Error("Failed to save mock exam result")}}export{U as Q,H as a,J as b,q as c,F as d,Y as g,Z as s};
//# sourceMappingURL=progressTracker-Ttbwvfu5.js.map
